<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Barrier Damage Tracker</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState } = React;
    
    const BarrierTracker = () => {
      const [step, setStep] = useState('input');
      const [moduleCount, setModuleCount] = useState('');
      const [projectName, setProjectName] = useState('');
      const [damagedParts, setDamagedParts] = useState(new Set());
      
      const validSizes = [2, 2.5, 3, 3.5, 4, 4.5, 5, 5.5, 6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5];
      
      const generateStructure = (size) => {
        const fullModules = Math.floor(size);
        const hasHalf = size % 1 !== 0;
        const parts = [];
        const gap = 10;
        const cornerWidth = 40;
        const cornerHeight = 120;
        const typicalWidth = 140;
        const typicalHeight = 38.25;
        const halfWidth = 70;
        const endCapWidth = cornerWidth * 2 + gap;
        const endCapHeight = 25;
        const endCapOffset = endCapHeight * 0.8;
        let xPos = 100;
        const backY = 60;
        
        parts.push({id: 'back-left-end-cap', name: 'Back Left End Cap', x: xPos, y: backY, width: endCapWidth, height: 25, type: 'corner'});
        parts.push({id: 'back-left-outside', name: 'Back Left Outside', x: xPos, y: backY + 30, width: cornerWidth, height: cornerHeight, type: 'corner'});
        parts.push({id: 'back-left-inside', name: 'Back Left Inside', x: xPos + cornerWidth + gap, y: backY + 30, width: cornerWidth, height: cornerHeight, type: 'corner'});
        xPos += cornerWidth * 2 + gap * 3;
        
        for (let i = 1; i <= fullModules; i++) {
          parts.push({id: `back-typical-${i}-outside`, name: `Typical Outside`, x: xPos, y: backY, width: typicalWidth, height: typicalHeight, type: 'typical'});
          parts.push({id: `back-typical-${i}-inside`, name: `Typical Inside`, x: xPos, y: backY + typicalHeight + gap, width: typicalWidth, height: typicalHeight, type: 'typical'});
          xPos += typicalWidth + gap;
        }
        
        if (hasHalf) {
          parts.push({id: 'back-half-outside', name: 'Half Typical Outside', x: xPos, y: backY, width: halfWidth, height: typicalHeight, type: 'typical'});
          parts.push({id: 'back-half-inside', name: 'Half Typical Inside', x: xPos, y: backY + typicalHeight + gap, width: halfWidth, height: typicalHeight, type: 'typical'});
          xPos += halfWidth + gap;
        }
        
        parts.push({id: 'back-right-outside', name: 'Back Right Outside', x: xPos, y: backY + 30, width: cornerWidth, height: cornerHeight, type: 'corner'});
        parts.push({id: 'back-right-inside', name: 'Back Right Inside', x: xPos + cornerWidth + gap, y: backY + 30, width: cornerWidth, height: cornerHeight, type: 'corner'});
        parts.push({id: 'back-right-end-cap', name: 'Back Right End Cap', x: xPos, y: backY, width: endCapWidth, height: 25, type: 'corner'});
        const rightX = xPos + cornerWidth * 2 + gap;
        const frontY = backY + 30 + cornerHeight + gap;
        
        parts.push({id: 'front-left-end-cap', name: 'Front Left End Cap', x: 100, y: frontY + cornerHeight + 30 - endCapOffset, width: endCapWidth, height: endCapHeight, type: 'corner'});
        parts.push({id: 'front-left-outside', name: 'Front Left Outside', x: 100, y: frontY, width: cornerWidth, height: cornerHeight, type: 'corner'});
        parts.push({id: 'front-left-inside', name: 'Front Left Inside', x: 100 + cornerWidth + gap, y: frontY, width: cornerWidth, height: cornerHeight, type: 'corner'});
        parts.push({id: 'front-right-end-cap', name: 'Front Right End Cap', x: rightX - endCapWidth, y: frontY + cornerHeight + 30 - endCapOffset, width: endCapWidth, height: endCapHeight, type: 'corner'});
        parts.push({id: 'front-right-outside', name: 'Front Right Outside', x: rightX - cornerWidth, y: frontY, width: cornerWidth, height: cornerHeight, type: 'corner'});
        parts.push({id: 'front-right-inside', name: 'Front Right Inside', x: rightX - cornerWidth * 2 - gap, y: frontY, width: cornerWidth, height: cornerHeight, type: 'corner'});
        
        return {parts, width: rightX + 100, height: frontY + cornerHeight + 100, frontY};
      };
      
      const handleModuleSubmit = () => {
        const size = parseFloat(moduleCount);
        if (!projectName.trim()) {
          alert('Please enter a project name');
          return;
        }
        if (validSizes.includes(size)) {
          setStep('tracking');
          setDamagedParts(new Set());
        } else {
          alert('Please enter a valid module size: 2, 2.5, 3, 3.5, 4, 4.5, 5, 5.5, 6, 6.5, 7, 7.5, 8, 8.5, 9, or 9.5');
        }
      };
      
      const toggleDamage = (partId) => {
        const newDamaged = new Set(damagedParts);
        if (newDamaged.has(partId)) {
          newDamaged.delete(partId);
        } else {
          newDamaged.add(partId);
        }
        setDamagedParts(newDamaged);
      };
      
      const handleDone = () => { setStep('complete'); };
      
      const handleReset = () => {
        setStep('input');
        setModuleCount('');
        setProjectName('');
        setDamagedParts(new Set());
      };
      
      const downloadReport = () => {
        const size = parseFloat(moduleCount);
        const structure = generateStructure(size);
        const damagedList = Array.from(damagedParts).map(id => {
          const part = structure.parts.find(p => p.id === id);
          return part ? part.name : id;
        });
        const countedList = {};
        damagedList.forEach(name => {
          countedList[name] = (countedList[name] || 0) + 1;
        });
        const formattedList = Object.entries(countedList).map(([name, count]) => 
          count > 1 ? `${count}x ${name}` : name
        );
        const reportContent = `BARRIER DAMAGE REPORT\nProject Name: ${projectName}\nStructure Size: ${moduleCount} modules\nDate: ${new Date().toLocaleDateString()}\nTime: ${new Date().toLocaleTimeString()}\n\nDAMAGED COMPONENTS:\n${formattedList.length > 0 ? formattedList.map((name, i) => `${i + 1}. ${name}`).join('\n') : 'No damaged components reported'}\n\nTotal Damaged Parts: ${damagedList.length}\n`;
        const blob = new Blob([reportContent], {type: 'text/plain'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `barrier-damage-report-${projectName.replace(/\s+/g, '-')}-${moduleCount}-modules-${new Date().toISOString().split('T')[0]}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      };
      
      if (step === 'input') {
        return (
          <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center p-8">
            <div className="bg-white rounded-lg shadow-xl p-8 max-w-md w-full">
              <h1 className="text-3xl font-bold text-gray-800 mb-6">Barrier Damage Tracker</h1>
              <p className="text-gray-600 mb-6">Enter the project details to begin tracking damaged barriers.</p>
              
              <label className="block text-sm font-medium text-gray-700 mb-2">Project Name</label>
              <input
                type="text"
                value={projectName}
                onChange={(e) => setProjectName(e.target.value)}
                placeholder="e.g., Main Street Parklet"
                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-4"
              />
              
              <label className="block text-sm font-medium text-gray-700 mb-2">Number of Modules</label>
              <input
                type="number"
                step="0.5"
                value={moduleCount}
                onChange={(e) => setModuleCount(e.target.value)}
                placeholder="e.g., 3.5"
                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-4"
              />
              
              <div className="text-sm text-gray-500 mb-6">
                Valid sizes: 2, 2.5, 3, 3.5, 4, 4.5, 5, 5.5, 6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5
              </div>
              
              <button
                onClick={handleModuleSubmit}
                className="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200"
              >
                Start Inspection
              </button>
            </div>
          </div>
        );
      }
      
      if (step === 'tracking') {
        const size = parseFloat(moduleCount);
        const structure = generateStructure(size);
        const cornerHeight = 120;
        const gap = 10;
        const backY = 60;
        const frontY = backY + 30 + cornerHeight + gap;
        
        return (
          <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 p-8">
            <div className="max-w-7xl mx-auto">
              <div className="bg-white rounded-lg shadow-xl p-8 mb-6">
                <div className="flex justify-between items-center mb-6">
                  <div>
                    <h1 className="text-3xl font-bold text-gray-800">Structure Plan View</h1>
                    <p className="text-gray-600 mt-2">Project: {projectName} | Size: {moduleCount} modules | Click panels to mark as damaged</p>
                  </div>
                  <button
                    onClick={handleDone}
                    className="bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-8 rounded-lg transition duration-200"
                  >
                    Done
                  </button>
                </div>
                <div className="bg-gray-50 rounded-lg p-8 overflow-x-auto">
                  <svg
                    viewBox={`0 0 ${structure.width} ${structure.height}`}
                    className="w-full"
                    style={{ maxHeight: '700px' }}
                  >
                    <line x1="30" y1={frontY + cornerHeight + 50} x2={structure.width - 30} y2={frontY + cornerHeight + 50} stroke="#1F2937" strokeWidth="3" />
                    <text x="30" y={frontY + cornerHeight + 70} className="text-base font-bold" fill="#1F2937">CURB</text>
                    {structure.parts.map(part => (
                      <rect
                        key={part.id}
                        x={part.x}
                        y={part.y}
                        width={part.width}
                        height={part.height}
                        fill={damagedParts.has(part.id) ? '#EF4444' : '#FFFFFF'}
                        stroke="#1F2937"
                        strokeWidth="3"
                        className="cursor-pointer transition-all duration-200 hover:opacity-70"
                        onClick={() => toggleDamage(part.id)}
                      />
                    ))}
                  </svg>
                </div>
                <div className="mt-6 p-4 bg-blue-50 rounded-lg">
                  <p className="text-sm text-blue-800">
                    <strong>Damaged parts: {damagedParts.size}</strong> - Click "Done" when finished to generate report
                  </p>
                </div>
              </div>
            </div>
          </div>
        );
      }
      
      if (step === 'complete') {
        const size = parseFloat(moduleCount);
        const structure = generateStructure(size);
        const damagedList = Array.from(damagedParts).map(id => {
          const part = structure.parts.find(p => p.id === id);
          return part ? part.name : id;
        });
        const countedList = {};
        damagedList.forEach(name => {
          countedList[name] = (countedList[name] || 0) + 1;
        });
        const formattedList = Object.entries(countedList).map(([name, count]) => 
          count > 1 ? `${count}x ${name}` : name
        );
        
        return (
          <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 p-8">
            <div className="max-w-4xl mx-auto">
              <div className="bg-white rounded-lg shadow-xl p-8">
                <h1 className="text-3xl font-bold text-gray-800 mb-6">Damage Report</h1>
                
                <div className="mb-6 p-6 bg-gray-50 rounded-lg">
                  <div className="grid grid-cols-2 gap-4 mb-4">
                    <div>
                      <p className="text-sm text-gray-600">Project Name</p>
                      <p className="text-xl font-semibold text-gray-800">{projectName}</p>
                    </div>
                    <div>
                      <p className="text-sm text-gray-600">Structure Size</p>
                      <p className="text-xl font-semibold text-gray-800">{moduleCount} modules</p>
                    </div>
                    <div>
                      <p className="text-sm text-gray-600">Total Damaged Parts</p>
                      <p className="text-xl font-semibold text-red-600">{damagedParts.size}</p>
                    </div>
                    <div>
                      <p className="text-sm text-gray-600">Date</p>
                      <p className="text-lg text-gray-800">{new Date().toLocaleDateString()}</p>
                    </div>
                    <div>
                      <p className="text-sm text-gray-600">Time</p>
                      <p className="text-lg text-gray-800">{new Date().toLocaleTimeString()}</p>
                    </div>
                  </div>
                </div>
                <div className="mb-6">
                  <h2 className="text-xl font-bold text-gray-800 mb-4">Damaged Components</h2>
                  {formattedList.length > 0 ? (
                    <div className="bg-red-50 rounded-lg p-6">
                      <ul className="space-y-2">
                        {formattedList.map((name, index) => (
                          <li key={index} className="flex items-start">
                            <span className="font-semibold text-red-600 mr-2">{index + 1}.</span>
                            <span className="text-gray-800">{name}</span>
                          </li>
                        ))}
                      </ul>
                    </div>
                  ) : (
                    <p className="text-gray-600 italic">No damaged components reported</p>
                  )}
                </div>
                <div className="flex gap-4">
                  <button
                    onClick={downloadReport}
                    className="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200 flex items-center justify-center gap-2"
                  >
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                      <polyline points="7 10 12 15 17 10"></polyline>
                      <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Download Report
                  </button>
                  <button
                    onClick={handleReset}
                    className="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200"
                  >
                    New Inspection
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      }
    };
    
    ReactDOM.render(<BarrierTracker />, document.getElementById('root'));
  </script>
</body>
</html>
